# iKnowHUST 软件设计报告

## 1. 项目概述

### 1.1 项目名称
iKnowHUST - 华科校园智能信息平台

### 1.2 项目简介
iKnowHUST 是一个专为华中科技大学学生打造的校园信息聚合与智能问答平台。通过AI技术为学生提供一站式、个性化的校园生活服务，解决校园信息分散、获取效率低下的问题。

### 1.3 技术栈
- **前端框架**: Next.js 15.3.3 (React 18.3.1)
- **UI组件库**: Radix UI + Tailwind CSS
- **后端服务**: Firebase (Firestore + Authentication)
- **AI服务**: Google Gemini AI (Genkit)
- **开发语言**: TypeScript
- **状态管理**: React Hooks + Context API

## 2. 系统架构设计

### 2.1 整体架构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端应用层     │    │   后端服务层     │    │   数据存储层     │
│   (Next.js)     │◄──►│   (Firebase)    │◄──►│  (Firestore)    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   AI服务层       │    │   认证服务       │    │   实时数据同步   │
│  (Gemini AI)    │    │ (Firebase Auth) │    │   (WebSocket)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 2.2 技术架构层次

#### 2.2.1 表现层 (Presentation Layer)
- **Next.js App Router**: 基于文件系统的路由管理
- **React组件**: 可复用的UI组件库
- **响应式设计**: 适配桌面和移动端

#### 2.2.2 业务逻辑层 (Business Logic Layer)
- **Firebase集成**: 统一的后端服务管理
- **状态管理**: React Context + Hooks
- **AI集成**: Genkit框架集成Google Gemini

#### 2.2.3 数据访问层 (Data Access Layer)
- **Firestore**: NoSQL文档数据库
- **实时同步**: 基于WebSocket的实时数据更新
- **离线支持**: Firebase离线缓存机制

## 3. 模块设计

### 3.1 核心模块

#### 3.1.1 用户认证模块
```typescript
// 位置: src/firebase/provider.tsx
interface FirebaseContextState {
  user: User | null;
  isUserLoading: boolean;
  userError: Error | null;
}
```
**功能**:
- 用户登录/注册
- 身份验证状态管理
- 权限控制

#### 3.1.2 新闻聚合模块
```typescript
// 位置: src/lib/news-data.ts
interface NewsItem {
  id: number;
  title: string;
  category: string;
  excerpt: string;
  content: string;
  imageId: string;
  date: string;
}
```
**功能**:
- 新闻数据管理
- 分类展示
- 图片资源管理

#### 3.1.3 聊天通信模块
```typescript
// 位置: src/app/(app)/chat/page.tsx
interface Chat {
  participantIds: string[];
  participantInfo: {[key: string]: UserInfo};
  lastMessage?: Message;
}
```
**功能**:
- 实时聊天
- 消息历史
- 用户状态管理

#### 3.1.4 AI智能问答模块
```typescript
// 位置: src/ai/genkit.ts
export const ai = genkit({
  plugins: [googleAI({apiKey: process.env.GEMINI_API_KEY})]
});
```
**功能**:
- 智能问答
- 自然语言处理
- 校园信息查询

### 3.2 页面模块

#### 3.2.1 主页面 (Dashboard)
- **路径**: `/`
- **功能**: 系统概览、快速导航
- **组件**: `src/app/(app)/page.tsx`

#### 3.2.2 新闻页面
- **路径**: `/news`
- **功能**: 新闻浏览、分类筛选
- **组件**: `src/app/(app)/news/page.tsx`

#### 3.2.3 聊天页面
- **路径**: `/chat`
- **功能**: 聊天列表、消息管理
- **组件**: `src/app/(app)/chat/page.tsx`

#### 3.2.4 社交页面
- **路径**: `/social`
- **功能**: 用户社交、好友管理
- **组件**: `src/app/(app)/social/page.tsx`

#### 3.2.5 社区页面
- **路径**: `/community`
- **功能**: 社区互动、信息发布
- **组件**: `src/app/(app)/community/page.tsx`

## 4. 数据库设计

### 4.1 Firestore集合结构

#### 4.1.1 用户集合 (users)
```typescript
interface User {
  uid: string;
  email: string;
  displayName: string;
  avatarId: string;
  imageBase64?: string;
  createdAt: Timestamp;
  lastLoginAt: Timestamp;
}
```

#### 4.1.2 聊天集合 (chats)
```typescript
interface Chat {
  id: string;
  participantIds: string[];
  participantInfo: {[key: string]: UserInfo};
  lastMessage?: {
    content?: string;
    senderId: string;
    timestamp: Timestamp;
    imageBase64?: string;
  };
  createdAt: Timestamp;
}
```

#### 4.1.3 消息集合 (messages)
```typescript
interface Message {
  id: string;
  chatId: string;
  senderId: string;
  content?: string;
  imageBase64?: string;
  timestamp: Timestamp;
  readBy: string[];
}
```

### 4.2 数据关系
- **一对多**: 用户 ↔ 聊天 (一个用户可以参与多个聊天)
- **一对多**: 聊天 ↔ 消息 (一个聊天包含多条消息)
- **多对多**: 用户 ↔ 用户 (好友关系)

## 5. 接口设计

### 5.1 Firebase服务接口

#### 5.1.1 认证服务
```typescript
// 用户认证Hook
export const useUser = (): UserHookResult => {
  return { user, isUserLoading, userError };
};
```

#### 5.1.2 Firestore服务
```typescript
// Firestore Hook
export const useFirestore = (): Firestore => {
  const { firestore } = useFirebase();
  return firestore;
};
```

#### 5.1.3 数据查询Hook
```typescript
// 集合查询Hook
export const useCollection = <T>(query: Query<T>) => {
  // 返回实时数据集合
};
```

### 5.2 AI服务接口

#### 5.2.1 Genkit配置
```typescript
export const ai = genkit({
  plugins: [googleAI({apiKey: process.env.GEMINI_API_KEY})]
});
```

## 6. 安全设计

### 6.1 认证安全
- **Firebase Authentication**: 基于JWT的身份验证
- **权限控制**: 基于用户角色的访问控制
- **会话管理**: 自动会话过期和刷新

### 6.2 数据安全
- **Firestore安全规则**: 基于用户身份的数据访问控制
- **数据加密**: 敏感数据加密存储
- **API密钥保护**: 环境变量管理

### 6.3 前端安全
- **XSS防护**: React内置XSS防护
- **CSRF防护**: SameSite Cookie策略
- **内容安全策略**: CSP头部配置

## 7. 性能优化

### 7.1 前端优化
- **代码分割**: Next.js自动代码分割
- **图片优化**: Next.js Image组件优化
- **缓存策略**: 静态资源缓存
- **懒加载**: 组件和路由懒加载

### 7.2 后端优化
- **Firestore索引**: 查询性能优化
- **实时同步**: 增量数据更新
- **离线支持**: 本地缓存机制

### 7.3 网络优化
- **CDN加速**: 静态资源CDN分发
- **压缩传输**: Gzip压缩
- **HTTP/2**: 多路复用连接

## 8. 部署架构

### 8.1 开发环境
- **本地开发**: Next.js开发服务器 (端口9002)
- **热重载**: 实时代码更新
- **调试工具**: React DevTools + Firebase调试

### 8.2 生产环境
- **静态部署**: Next.js静态导出
- **CDN分发**: 全球内容分发网络
- **监控告警**: 性能监控和错误追踪

## 9. 扩展性设计

### 9.1 水平扩展
- **微服务架构**: 模块化服务设计
- **负载均衡**: 多实例部署
- **数据库分片**: Firestore自动分片

### 9.2 功能扩展
- **插件系统**: 模块化功能扩展
- **API版本控制**: 向后兼容的API设计
- **多租户支持**: 多学校支持架构

## 10. 总结

iKnowHUST采用现代化的技术栈和架构设计，具备良好的可扩展性、安全性和性能。通过Next.js + Firebase的组合，实现了快速开发和部署，同时保证了系统的稳定性和用户体验。

**主要优势**:
- 技术栈现代化，开发效率高
- 架构清晰，模块化程度高
- 安全性设计完善
- 性能优化到位
- 扩展性良好

**技术特色**:
- 全栈TypeScript开发
- 实时数据同步
- AI智能集成
- 响应式设计
- 离线支持
